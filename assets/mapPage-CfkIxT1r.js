import{ad as le,aa as ce,ae as ue,r as x,a6 as f}from"./index-B9ypTNXF.js";import{az as X,v as pe,a4 as Y,S as de,r as fe,P as he,W as me,E as ge,aA as Me,a9 as we,aB as Ae,u as K,t as be,a2 as ve,Z as xe,aC as ye,a8 as Le,a as ke,e as Ie}from"./three.module-BpwjgnkF.js";import{O as Ue}from"./OrbitControls-Xk-DHyd9.js";var Q={exports:{}};(function(T,_){(function(t,y){T.exports=y()})(le,function(){function t(e){var p=[];return e.AMapUI&&p.push(y(e.AMapUI)),e.Loca&&p.push(V(e.Loca)),Promise.all(p)}function y(e){return new Promise(function(p,n){var l=[];if(e.plugins)for(var c=0;c<e.plugins.length;c+=1)i.AMapUI.plugins.indexOf(e.plugins[c])==-1&&l.push(e.plugins[c]);if(d.AMapUI===s.failed)n("å‰æ¬¡è¯·æ±‚ AMapUI å¤±è´¥");else if(d.AMapUI===s.notload){d.AMapUI=s.loading,i.AMapUI.version=e.version||i.AMapUI.version,c=i.AMapUI.version;var m=document.body||document.head,h=document.createElement("script");h.type="text/javascript",h.src="https://webapi.amap.com/ui/"+c+"/main.js",h.onerror=function(u){d.AMapUI=s.failed,n("è¯·æ±‚ AMapUI å¤±è´¥")},h.onload=function(){if(d.AMapUI=s.loaded,l.length)window.AMapUI.loadUI(l,function(){for(var u=0,A=l.length;u<A;u++){var k=l[u].split("/").slice(-1)[0];window.AMapUI[k]=arguments[u]}for(p();w.AMapUI.length;)w.AMapUI.splice(0,1)[0]()});else for(p();w.AMapUI.length;)w.AMapUI.splice(0,1)[0]()},m.appendChild(h)}else d.AMapUI===s.loaded?e.version&&e.version!==i.AMapUI.version?n("ä¸å…è®¸å¤šä¸ªç‰ˆæœ¬ AMapUI æ··ç”¨"):l.length?window.AMapUI.loadUI(l,function(){for(var u=0,A=l.length;u<A;u++){var k=l[u].split("/").slice(-1)[0];window.AMapUI[k]=arguments[u]}p()}):p():e.version&&e.version!==i.AMapUI.version?n("ä¸å…è®¸å¤šä¸ªç‰ˆæœ¬ AMapUI æ··ç”¨"):w.AMapUI.push(function(u){u?n(u):l.length?window.AMapUI.loadUI(l,function(){for(var A=0,k=l.length;A<k;A++){var W=l[A].split("/").slice(-1)[0];window.AMapUI[W]=arguments[A]}p()}):p()})})}function V(e){return new Promise(function(p,n){if(d.Loca===s.failed)n("å‰æ¬¡è¯·æ±‚ Loca å¤±è´¥");else if(d.Loca===s.notload){d.Loca=s.loading,i.Loca.version=e.version||i.Loca.version;var l=i.Loca.version,c=i.AMap.version.startsWith("2"),m=l.startsWith("2");if(c&&!m||!c&&m)n("JSAPI ä¸ Loca ç‰ˆæœ¬ä¸å¯¹åº”ï¼ï¼");else{c=i.key,m=document.body||document.head;var h=document.createElement("script");h.type="text/javascript",h.src="https://webapi.amap.com/loca?v="+l+"&key="+c,h.onerror=function(u){d.Loca=s.failed,n("è¯·æ±‚ AMapUI å¤±è´¥")},h.onload=function(){for(d.Loca=s.loaded,p();w.Loca.length;)w.Loca.splice(0,1)[0]()},m.appendChild(h)}}else d.Loca===s.loaded?e.version&&e.version!==i.Loca.version?n("ä¸å…è®¸å¤šä¸ªç‰ˆæœ¬ Loca æ··ç”¨"):p():e.version&&e.version!==i.Loca.version?n("ä¸å…è®¸å¤šä¸ªç‰ˆæœ¬ Loca æ··ç”¨"):w.Loca.push(function(u){u?n(u):n()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var s;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(s||(s={}));var i={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},d={AMap:s.notload,AMapUI:s.notload,Loca:s.notload},w={AMap:[],AMapUI:[],Loca:[]},E=[],L=function(e){typeof e=="function"&&(d.AMap===s.loaded?e(window.AMap):E.push(e))};return{load:function(e){return new Promise(function(p,n){if(d.AMap==s.failed)n("");else if(d.AMap==s.notload){var l=e.key,c=e.version,m=e.plugins;l?(window.AMap&&location.host!=="lbs.amap.com"&&n("ç¦æ­¢å¤šç§APIåŠ è½½æ–¹å¼æ··ç”¨"),i.key=l,i.AMap.version=c||i.AMap.version,i.AMap.plugins=m||i.AMap.plugins,d.AMap=s.loading,c=document.body||document.head,window.___onAPILoaded=function(u){if(delete window.___onAPILoaded,u)d.AMap=s.failed,n(u);else for(d.AMap=s.loaded,t(e).then(function(){p(window.AMap)}).catch(n);E.length;)E.splice(0,1)[0]()},m=document.createElement("script"),m.type="text/javascript",m.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+i.AMap.version+"&key="+l+"&plugin="+i.AMap.plugins.join(","),m.onerror=function(u){d.AMap=s.failed,n(u)},c.appendChild(m)):n("è¯·å¡«å†™key")}else if(d.AMap==s.loaded)if(e.key&&e.key!==i.key)n("å¤šä¸ªä¸ä¸€è‡´çš„ key");else if(e.version&&e.version!==i.AMap.version)n("ä¸å…è®¸å¤šä¸ªç‰ˆæœ¬ JSAPI æ··ç”¨");else{if(l=[],e.plugins)for(c=0;c<e.plugins.length;c+=1)i.AMap.plugins.indexOf(e.plugins[c])==-1&&l.push(e.plugins[c]);l.length?window.AMap.plugin(l,function(){t(e).then(function(){p(window.AMap)}).catch(n)}):t(e).then(function(){p(window.AMap)}).catch(n)}else if(e.key&&e.key!==i.key)n("å¤šä¸ªä¸ä¸€è‡´çš„ key");else if(e.version&&e.version!==i.AMap.version)n("ä¸å…è®¸å¤šä¸ªç‰ˆæœ¬ JSAPI æ··ç”¨");else{var h=[];if(e.plugins)for(c=0;c<e.plugins.length;c+=1)i.AMap.plugins.indexOf(e.plugins[c])==-1&&h.push(e.plugins[c]);L(function(){h.length?window.AMap.plugin(h,function(){t(e).then(function(){p(window.AMap)}).catch(n)}):t(e).then(function(){p(window.AMap)}).catch(n)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,i={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},d={AMap:s.notload,AMapUI:s.notload,Loca:s.notload},w={AMap:[],AMapUI:[],Loca:[]}}}})})(Q);var Se=Q.exports;const Ce=ce(Se);function ze(){const T=_();function _(){let a=ue().search.split("?")[1],o={};return a.split("&").forEach(r=>{o[r.split("=")[0]]=r.split("=")[1]}),o}const[t,y]=x.useState({map:null,AMap:null,markers:[],polyline:null,infoWindow:null,heatmap:null,markerCluster:null,earthScene:null,earthRenderer:null,earthCamera:null,earthControls:null}),[V,s]=x.useState(!0),[i,d]=x.useState(!0),[w,E]=x.useState("normal"),[L,e]=x.useState(!1),p=x.useRef(null),n=x.useRef(null),[l]=x.useState([{title:"åšçº³åº·ç¯ä¿ç§‘æŠ€æœ‰é™å…¬å¸",lng:106.648224,lat:26.648522,content:"ä¸»è¦è´Ÿè´£å›½ä¼å’Œæ”¿åºœé¡¹ç›®çš„å‰ç«¯å¼€å‘ï¼Œç»´æŠ¤Vue2è€é¡¹ç›®ï¼Œä½¿ç”¨è‹¥ä¾æ¡†æ¶åŸºäºVite+Vue3è¿›è¡Œåå°ç®¡ç†ç³»ç»Ÿã€ä¼ä¸šç½‘ç«™å’Œå¯è§†åŒ–æ•°æ®å¤§å±çš„äºŒæ¬¡å¼€å‘ï¼ŒåŒæ—¶ä½¿ç”¨UniAppå¼€å‘H5ã€Appå’Œå¾®ä¿¡å°ç¨‹åºç­‰è·¨å¹³å°åº”ç”¨",id:1},{title:"æ­å·ä½³è·‘ç§‘æŠ€æœ‰é™å…¬å¸",lng:119.998336,lat:30.280531,content:"å…¨æƒè´Ÿè´£å…¬å¸äº§å“åå°ç®¡ç†ç³»ç»Ÿå’Œè·¨å¹³å°Appçš„å¼€å‘ä¸è¿›åº¦ç®¡ç†ï¼Œåå°ä½¿ç”¨Vite+ReactæŠ€æœ¯æ ˆæ„å»ºï¼ŒAppé‡‡ç”¨UniAppå®ç°è·¨å¹³å°å¼€å‘ï¼Œä¸»å¯¼æ•´ä¸ªé¡¹ç›®çš„æ¶æ„è®¾è®¡å’Œæ ¸å¿ƒåŠŸèƒ½å®ç°",id:2},{title:"æ±‡æ™ºé“æ™Ÿ(æ­å·)è½¯ä»¶æœ‰é™å…¬å¸",lng:120.240877,lat:30.300348,content:"åœ¨10äººå¼€å‘å›¢é˜Ÿä¸­å‚ä¸è½¯ä»¶å¤–åŒ…é¡¹ç›®ååŒå¼€å‘ï¼Œä½¿ç”¨GitLabè¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå‚ä¸å…¬å¸ä»Vue2åˆ°Vue3çš„æŠ€æœ¯æ ˆå‡çº§è¿‡ç¨‹ï¼ŒåŒæ—¶ç»´æŠ¤Reactå¤§å‹åå°é¡¹ç›®å’ŒåŸºäºUniAppçš„è·¨å¹³å°åº”ç”¨å¼€å‘",id:3}]),c=()=>{if(t.earthRenderer&&t.earthRenderer.dispose(),!n.current){console.error("åœ°çƒå®¹å™¨ä¸å­˜åœ¨");return}console.log("å¼€å§‹åˆ›å»ºåœ°çƒ...");const a=new de;a.background=new fe(17),console.log("åœºæ™¯åˆ›å»ºå®Œæˆ");const o=new he(75,n.current.clientWidth/n.current.clientHeight,.1,1e3);o.position.set(-1,2.5,-4),console.log("ç›¸æœºåˆ›å»ºå®Œæˆï¼Œä½ç½®:",o.position);const r=new me({antialias:!0});r.setSize(n.current.clientWidth,n.current.clientHeight),r.setPixelRatio(window.devicePixelRatio),n.current.appendChild(r.domElement);const b=new X(1,64,64),S=new ge().load("public/earth_atmos_2048.jpg"),$=new Me({map:S,transparent:!0,opacity:1,shininess:30,specular:4473924}),N=new Y(b,$),I=new we;I.add(N);const B=new Ae(4210752,.3);a.add(B);const v=new K(16777215,1);v.position.set(-1,2.5,-4),I.add(v);const j=new K(16777215,.8);j.position.set(-1,2.5,-4),I.add(j);const C=new be(16777215,.5,10);C.position.set(-1,2.5,-4),I.add(C),a.add(I);const H=new ve,ne=new xe({color:16777215,size:1,transparent:!0,opacity:.8}),Z=[];for(let U=0;U<2e3;U++){const P=(Math.random()-.5)*2e3,D=(Math.random()-.5)*2e3,z=(Math.random()-.5)*2e3;Z.push(P,D,z)}H.setAttribute("position",new ye(Z,3));const oe=new Le(H,ne);a.add(oe);const M=new Ue(o,r.domElement);M.enableDamping=!0,M.dampingFactor=.05,M.rotateSpeed=.5,M.enableZoom=!0,M.enablePan=!1,M.minDistance=1.5,M.maxDistance=7,M.target.set(0,0,0),M.addEventListener("change",()=>{o.position.distanceTo(M.target)<1.51&&(e(!1),u())}),I.userData={isEarthGroup:!0};const J=new ke,F=new Ie,re=U=>{console.log("åœ°çƒè¢«ç‚¹å‡»",888888);const P=r.domElement.getBoundingClientRect();F.x=(U.clientX-P.left)/P.width*2-1,F.y=-((U.clientY-P.top)/P.height)*2+1,J.setFromCamera(F,o);const D=J.intersectObject(N);if(D.length>0){const z=D[0].point,R=90-Math.acos(z.y)*(180/Math.PI),G=Math.atan2(z.z,-z.x)*(180/Math.PI)-180;if(A(G,R,`åœ°çƒæ ‡è®°ç‚¹ (${G.toFixed(2)}, ${R.toFixed(2)})`),t.map&&t.AMap){const ie=new t.AMap.LngLat(G,R);k(ie,`åœ°çƒæ ‡è®°ç‚¹ (${G.toFixed(2)}, ${R.toFixed(2)})`)}}};r.domElement.addEventListener("click",re);const q=()=>{requestAnimationFrame(q),M.update(),r.render(a,o)};q();const se=()=>{n.current&&(o.aspect=n.current.clientWidth/n.current.clientHeight,o.updateProjectionMatrix(),r.setSize(n.current.clientWidth,n.current.clientHeight))};return window.addEventListener("resize",se),y(U=>({...U,earthScene:a,earthRenderer:r,earthCamera:o,earthControls:M})),{scene:a,renderer:r,camera:o,controls:M}},m=async()=>{try{s(!0);const a=await Ce.load({key:"1dcb65ff8e3291a5482a82f856b87ea0",version:"2.0",plugins:["AMap.LabelsLayer","AMap.3DTilesLayer","AMap.PlaceSearch","AMap.Driving","AMap.Geolocation","AMap.ToolBar","AMap.Scale","AMap.HawkEye","AMap.MapType","AMap.ControlBar","AMap.HeatMap","AMap.MarkerCluster","AMap.Buildings","AMap.IndoorMap"]});let o=l.find(g=>g.id==T.id);const r=await new a.Map("mapPage",{center:o?[o.lng,o.lat]:[106.648341,26.620042],zoom:o?15:6,zooms:[5,20],viewMode:"3D",pitch:50,rotation:10,features:["bg","road","point","building"],skyColor:"#0e1c35",mapStyle:"amap://styles/normal",worldMapZoom:4,buildingAnimation:!0,showBuilding:!0});r.on("zoomend",()=>{const g=r.getZoom();g<=5&&!L?(e(!0),h()):g>5&&L&&(e(!1),u())}),r.addControl(new a.Scale({position:"LB"}));const b=new a.InfoWindow({offset:new a.Pixel(0,-30)});r.on("click",g=>{console.log("ç‚¹å‡»ä½ç½®:",g.lnglat.lng,g.lnglat.lat)}),y(g=>({...g,map:r,AMap:a,markers:[],polyline:null,infoWindow:b,heatmap:null,markerCluster:null})),s(!1)}catch(a){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",a),s(!1)}},h=()=>{n.current&&(p.current&&(p.current.style.display="none"),n.current&&(n.current.style.display="block"),c(),setTimeout(()=>{t.markers.length>0&&t.earthScene&&t.markers.forEach(a=>{const o=a.getPosition();A(o.lng,o.lat,a.getTitle())})},100))},u=()=>{n.current&&(n.current.style.display="none"),p.current&&(p.current.style.display="block"),t.earthRenderer&&t.earthRenderer.dispose()},A=(a,o,r="æ ‡è®°ç‚¹")=>{if(!t.earthScene)return;const b=(90-o)*(Math.PI/180),g=(a+180)*(Math.PI/180),S=-(1.1*Math.sin(b)*Math.cos(g)),$=1.1*Math.sin(b)*Math.sin(g),N=1.1*Math.cos(b),I=new X(.02,8,8),B=new pe({color:16711680}),v=new Y(I,B);v.position.set(S,N,$),v.userData={title:r,lng:a,lat:o};const j=t.earthScene.children.find(C=>C.type==="Group"&&C.userData&&C.userData.isEarthGroup);return j?j.add(v):t.earthScene.add(v),v.userData.onClick=()=>{console.log(`ç‚¹å‡»äº†æ ‡è®°ç‚¹: ${r} (${a.toFixed(6)}, ${o.toFixed(6)})`)},v},k=(a,o="æ ‡è®°ç‚¹",r)=>{if(!t.map||!t.AMap)return;const b=new t.AMap.Marker({position:a,title:o,name:o,icon:new t.AMap.Icon({size:new t.AMap.Size(50,55),imageSize:new t.AMap.Size(50,55),image:"src/assets/dwIcon.webp"}),offset:new t.AMap.Pixel(-25,-55)});new t.AMap.Text({position:a,title:o,anchor:"top-center",offset:new t.AMap.Pixel(0,-105),text:o,style:{backgroundColor:"rgba(0,188,255,.5)",borderRadius:"8px",fontSize:"14px",padding:"8px",color:"#fff",border:"rgba(14,68,123,.7)"}}).setMap(t.map),b.setMap(t.map),b.on("click",()=>{t.infoWindow.setContent(`
                <div style="padding: 10px;color: #000">
                    <h4>${o}</h4>
                    <div>${r.content}</div>
                </div>
            `),t.infoWindow.setOffset(new t.AMap.Pixel(0,-55)),t.infoWindow.open(t.map,a)}),L&&t.earthScene&&A(a.lng,a.lat,o),y(S=>({...S,markers:[...S.markers,b]}))},W=()=>{if(t.markers.forEach(a=>{a.setMap(null)}),t.earthScene){const a=t.earthScene.children.find(o=>o.type==="Group"&&o.userData&&o.userData.isEarthGroup);a?a.children.filter(r=>r.userData&&r.userData.title).forEach(r=>{a.remove(r)}):t.earthScene.children.filter(r=>r.userData&&r.userData.title).forEach(r=>{t.earthScene.remove(r)})}y(a=>({...a,markers:[]}))},ee=()=>{!t.map||!t.AMap||l.forEach(a=>{k(new t.AMap.LngLat(a.lng,a.lat),a.title,a)})},O=a=>{if(t.map)switch(E(a),a){case"dark":t.map.setMapStyle("amap://styles/blue");break;default:t.map.setMapStyle("amap://styles/normal");break}},te=()=>{t.map&&(t.map.setZoom(3),h(),e(!0))},ae=()=>{t.map&&(t.map.setZoom(5),u(),e(!1))};return x.useEffect(()=>{m(),setTimeout(()=>{var a;(a=document.getElementById("getCurrentLocation"))==null||a.click()},1e3)},[]),f.jsxs("div",{className:"w-screen h-screen bg-[#000000] text-[#ffffff] overflow-hidden relative",children:[V&&f.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsx("div",{className:"text-white text-lg",children:"åœ°å›¾åŠ è½½ä¸­..."})}),i&&f.jsx("div",{className:"absolute top-4 left-4 z-40 bg-black bg-opacity-70 p-4 rounded-lg max-w-xs",children:f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("button",{onClick:ee,id:"getCurrentLocation",className:"w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"å®šä½"}),f.jsx("button",{onClick:W,className:"w-full px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"æ¸…é™¤æ ‡è®°"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("div",{className:"text-sm font-medium",children:"è§†å›¾æ¨¡å¼:"}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("button",{onClick:te,className:`px-2 py-1 text-xs rounded ${L?"bg-blue-600":"bg-gray-600 hover:bg-gray-700"}`,children:"åœ°çƒè§†å›¾"}),f.jsx("button",{onClick:ae,className:`px-2 py-1 text-xs rounded ${L?"bg-gray-600 hover:bg-gray-700":"bg-blue-600"}`,children:"å¹³é¢è§†å›¾"})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("div",{className:"text-sm font-medium",children:"åœ°å›¾ç±»å‹:"}),f.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[f.jsx("button",{onClick:()=>O("normal"),className:`px-2 py-1 text-xs rounded ${w==="normal"?"bg-blue-600":"bg-gray-600 hover:bg-gray-700"}`,children:"æ ‡å‡†"}),f.jsx("button",{onClick:()=>O("dark"),className:`px-2 py-1 text-xs rounded ${w==="dark"?"bg-blue-600":"bg-gray-600 hover:bg-gray-700"}`,children:"æš—è‰²"})]})]})]})}),f.jsxs("button",{onClick:()=>d(!i),className:"absolute top-4 right-4 z-40 bg-black bg-opacity-70 p-2 rounded-lg hover:bg-opacity-90 transition-all",children:[i?"éšè—":"æ˜¾ç¤º","æ§åˆ¶é¢æ¿"]}),f.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-40 bg-black bg-opacity-70 px-3 py-1 rounded-lg text-sm",children:L?"ğŸŒ åœ°çƒè§†å›¾":"ğŸ—ºï¸ å¹³é¢è§†å›¾"}),f.jsx("div",{id:"mapPage",ref:p,className:"w-full h-full"}),f.jsx("div",{ref:n,className:"w-full h-full absolute inset-0 hidden z-10"})]})}export{ze as default};
